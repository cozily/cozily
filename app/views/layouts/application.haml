%html
  %head
    = stylesheet_link_tag 'formtastic'
    = stylesheet_link_tag 'formtastic_changes'
    = stylesheet_link_tag 'jquery-ui'
    = stylesheet_link_tag 'compiled/screen.css', :media => 'screen, projection'
    = stylesheet_link_tag 'compiled/print.css', :media => 'print'
    /[if lt IE 8]
      = stylesheet_link_tag 'compiled/ie.css', :media => 'screen, projection'


    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    = javascript_include_tag "http://use.typekit.com/cco3tph.js"
    = javascript_include_tag 'jquery'
    = javascript_include_tag 'jquery-ui'
    = javascript_include_tag 'jquery.scrollTo'
    = javascript_include_tag 'jquery.tabSlideOut'
    = javascript_include_tag 'jquery.spicyselect'
    = javascript_include_tag 'ajaxupload'
    = javascript_include_tag 'application'
    = javascript_include_tag 'maps'

    :javascript
      try{Typekit.load();}catch(e){}

    %title
      Cozily

  %body{:class => "#{controller.controller_name} #{controller.action_name}"}
    #head
      .container
        =link_to image_tag("logos/logo.png"), root_url

        %ul.nav
          -if current_user.try(:lister?)
            %li=link_to_unless_current "my listings", dashboard_listings_path
            %li=link_to "New Listing", new_apartment_path
          -if current_user.try(:finder?)
            %li=link_to_unless_current "matches", dashboard_matches_path
            %li=link_to_unless_current "favorites", dashboard_favorites_path

        =render "sessions/nav_actions"

    -if current_user
      #search
        .container
          %h2 Find Apartments

          -form_for :q, Search.new(:min_bedrooms => "", :max_rent => "All Prices"), :url => search_path, :html => {:method => :get} do |f|
            =f.select :neighborhood_ids, Neighborhood.to_dropdown, :prompt => "All Neighborhoods"
            =f.select :min_bedrooms, Search::BEDROOMS, :prompt => "All # Bedrooms"
            =f.text_field :max_rent, :'data-default-value' => "All Prices"

            =f.submit :search


      #breadcrumbs
        -if current_user.try(:finder?)
          .profile_summary
            =profile_summary(current_user.profile)
            %span=link_to("update", edit_user_profile_path(current_user))

    #body
      .container
        #flash
          %span=flash[:success] || flash[:notice] || flash[:failure]
        #loading
          %span Loading...
        %div{:'data-content-key' => 'yield'}
          =yield

    #foot
      .container
        %ul
          %li=link_to "About", about_page_path
          %li=link_to "FAQ", faq_page_path
          %li=link_to "Privacy Policy", privacy_policy_page_path
          %li=link_to "Terms of Service", terms_of_service_page_path
          %li.twitter=link_to image_tag("icons/twitter.png"), "http://www.twitter.com/cozidotly", :target => "_blank"
          %li.facebook=link_to image_tag("icons/facebook.png"), "http://www.facebook.com/pages/Cozily/125237897517891", :target => "_blank"
          %li.copyright="&copy; #{Time.now.year} Cozily All Rights Reserved"

    =render "feedback/feedback"

    :javascript
      window._token = '#{form_authenticity_token}';
      var ip_lat = '#{ip_lat}';
      var ip_lng = '#{ip_lng}';
      var neighborhoods = #{Neighborhood.to_autocomplete.to_json};

    :javascript
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-6802573-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
