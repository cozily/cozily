-if @apartment.published? || (signed_in? && current_user.apartments.include?(@apartment))
  :javascript
    var self = #{@apartment.as_json(:methods => :to_param, :include => :address).to_json};
    var apartments = #{(Apartment.with_state(:published) - [@apartment]).as_json(:methods => :to_param, :include => :address).to_json};

  .head
    .name
      %h1=@apartment.address.street
      %h2==#{@apartment.address.city}, #{@apartment.address.state} #{@apartment.address.zip}

    %ul.actions
      -if can? :edit, @apartment
        %li=link_to "edit apartment", edit_apartment_path(@apartment)
      %li=render "flags/link", :apartment => @apartment
      %li=render "favorites/link", :apartment => @apartment

  %br{:style => "clear:both"}

  .article
    -if @apartment.images.present?
      =image_tag @apartment.images.first.asset.url(:large)
    -else
      %img{:src => 'http://www.google.com'}

    .info
      .rooms
        ==#{@apartment.bedrooms.prettify}bd/#{@apartment.bathrooms.prettify}ba
      .rent
        ==$#{@apartment.rent.prettify}

      %ul
        %li==#{@apartment.square_footage.prettify} sq. ft.
        %li
          -if @apartment.address && @apartment.neighborhood
            ==Neighborhood: #{link_to @apartment.neighborhood.name, @apartment.neighborhood}
          -else
            Neighborhood: Unknown
        %li==Available starting #{@apartment.start_date}

  .aside
    #map_canvas

    %dl
      -if @apartment.contact
        %dt Contact
        %dd
          =@apartment.contact.name
          =@apartment.contact.email
          =@apartment.contact.phone

        %dt Nearby stations
        %dd
          %ul
            -@apartment.nearby_stations.each do |station|
              %li
                =station.name
                =station.distance

    -if @apartment.address
      .business_search{:'data-lat' => @apartment.lat, :'data-lng' => @apartment.lng}

  %ul
    -@apartment.features.each do |feature|
      %li=feature.name

  %ul
    -@apartment.images.each do |image|
      %li=image_tag image.asset.url(:medium)


  -if can? :manage, Message
    =render "messages/thread", :messages => @apartment.messages.for_user(current_user)

-else
  %p This apartment is unpublished.

